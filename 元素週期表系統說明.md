# 元素週期表精煉系統

## 系統概述

精煉系統已成功升級為基於元素週期表的系統，包含64種化學元素，分為三個稀有度等級。

## 元素分類

### 常見元素 (Common) - 70% 機率
- **數量**: 18個元素
- **包含**: H(氫), He(氦), Li(鋰), Be(鈹), B(硼), C(碳), N(氮), O(氧), F(氟), Ne(氖), Na(鈉), Mg(鎂), Al(鋁), Si(矽), P(磷), S(硫), Cl(氯), Ar(氬)
- **顏色**: 綠色標籤

### 稀有元素 (Rare) - 25% 機率
- **數量**: 36個元素
- **包含**: K(鉀), Ca(鈣), Sc(鈧), Ti(鈦), V(釩), Cr(鉻), Mn(錳), Fe(鐵), Co(鈷), Ni(鎳), Cu(銅), Zn(鋅), Ga(鎵), Ge(鍺), As(砷), Se(硒), Br(溴), Kr(氪), Ag(銀), Cd(鎘), In(銦), Sn(錫), Sb(銻), Te(碲), I(碘), Xe(氙), Cs(銫), Ba(鋇), Au(金), Hg(汞), Tl(鉈), Pb(鉛), Bi(鉍), Po(釙), At(砈), Rn(氡)
- **顏色**: 橙色標籤

### 極稀有元素 (Very-Rare) - 5% 機率
- **數量**: 10個元素
- **包含**: Fr(鈁), Ra(鐳), Ac(錒), Th(釷), Pa(鏷), U(鈾), Np(錼), Pu(鈈), Am(鋂), Cm(鋦)
- **顏色**: 紅色標籤

## 隨機選擇機制

### 兩階段選擇系統
1. **稀有度選擇**: 根據權重隨機選擇稀有度等級
   - 常見元素: 70% 機率
   - 稀有元素: 25% 機率
   - 極稀有元素: 5% 機率

2. **元素選擇**: 在選中的稀有度等級內隨機選擇具體元素

### 測試結果驗證
- **1000次測試**: 常見元素71.8%, 稀有元素23.0%, 極稀有元素5.2%
- **分布合理**: 與期望值偏差在可接受範圍內

## 數據庫結構更新

### Material 模型
```python
class Material(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    symbol = db.Column(db.String(10), nullable=False)  # 元素符號
    name = db.Column(db.String(50), nullable=False)    # 元素中文名
    description = db.Column(db.Text)
    base_value = db.Column(db.Float, default=0.0)      # 基礎價值
    rarity = db.Column(db.String(20), default='common') # 稀有度
    color = db.Column(db.String(7), default='#000000')  # 元素顏色
    is_active = db.Column(db.Boolean, default=True)     # 是否可精煉
```

### User 模型
```python
class User(UserMixin, db.Model):
    # ... 其他字段 ...
    element_inventory = db.Column(db.JSON, default=dict)  # 元素庫存
```

## 前端顯示

### 儀表板頁面
- 顯示用戶擁有的所有元素
- 按稀有度使用不同顏色標籤
- 只顯示有庫存的元素

### 精煉頁面
- 移除材料選擇下拉選單
- 顯示"產出元素: 由系統隨機決定"
- 更新預覽功能以反映隨機選擇

## 技術實現

### 精煉邏輯
```python
# 基於稀有度的加權隨機選擇
rarity_weights = {
    'common': 0.7,      # 70% 機率
    'rare': 0.25,       # 25% 機率
    'very-rare': 0.05   # 5% 機率
}

# 兩階段選擇
selected_rarity = random.choices(
    list(rarity_weights.keys()),
    weights=list(rarity_weights.values())
)[0]

available_materials = materials_by_rarity[selected_rarity]
selected_material = random.choice(available_materials)
```

### 庫存管理
```python
# 動態更新元素庫存
element_name = selected_material.name
if element_name not in current_user.element_inventory:
    current_user.element_inventory[element_name] = 0.0
current_user.element_inventory[element_name] += material_amount
```

## 初始化腳本

使用 `init_elements.py` 腳本初始化數據庫：
```bash
python init_elements.py
```

## 系統優勢

1. **教育價值**: 結合化學知識，增加學習樂趣
2. **收集樂趣**: 64種元素提供豐富的收集體驗
3. **稀有度系統**: 不同稀有度增加遊戲深度
4. **視覺效果**: 每個元素都有獨特的顏色標識
5. **擴展性**: 可以輕鬆添加更多元素或稀有度等級

## 注意事項

- 系統會自動處理新元素的庫存初始化
- 精煉結果完全隨機，不受用戶控制
- 稀有度權重可以根據需要調整
- 所有元素都有對應的化學符號和中文名稱 